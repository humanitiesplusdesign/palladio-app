angular.module("palladioCardsComponent",["palladio","palladio.services"]).run(["componentService",function(i){var t=function(i,t){i.showSettings=void 0!==i.showSettings&&i.showSettings,i.cardsHeight=void 0===i.height?void 0:i.height,i.functions={};var n='<div class="with-settings" data-palladio-list-view-with-settings ';return n+='show-settings="showSettings" ',n+='cards-height="cardsHeight" ',n+="functions=functions ",i.titleDim&&(n+='config-title-dimension="titleDim" '),i.subtitleDim&&(n+='config-sub-title-dimension="subtitleDim" '),i.textDim&&(n+='config-text-dimension="textDim" '),i.linkDim&&(n+='config-link-dimension="linkDim" '),i.imgUrlDim&&(n+='config-img-url-dimension="imgUrlDim" '),i.sortDim&&(n+='config-sort-dimension="sortDim" '),n+="></div>"};i.register("cards",t)}]).directive("palladioListView",["palladioService",function(i){var t={scope:{listDimension:"=listDimension",cardsHeight:"=",max:"=maxToDisplay",imageURLFunc:"=imgUrlAccessor",titleFunc:"=titleAccessor",subtitleFunc:"=subtitleAccessor",textFunc:"=textAccessor",linkFunc:"=linkAccessor",sortOptions:"=sortOptions"},link:function(t,n){function e(){t.cardsHeight?t.calcHeight=t.cardsHeight:t.calcHeight=$(window).height(),n.height(t.calcHeight)}function s(i,t){i!==t&&o()}function o(){t.titleFunc&&t.imageURLFunc&&t.subtitleFunc&&t.textFunc&&t.linkFunc&&t.sortOptions.length&&(d=t.listDimension.group(),m=d3.map(),u=0,t.listDimension.top(1/0).forEach(function(i){m.set(t.listDimension.accessor(i),{title:t.titleFunc(i),imageURL:t.imageURLFunc(i),subtitle:t.subtitleFunc(i),text:t.textFunc(i),link:t.linkFunc(i),sortBy:t.sortOptions.map(function(t){return i[t.attribute]})})}),d3.select(n[0]).select("div#list-display").remove(),g=d3.select(n[0]).append("div").attr("class","row").attr("id","list-display"),l())}function l(){listBoxes=g.selectAll(".list-wrap").data(d.top(t.max).filter(function(i){return 0!==i.value}),function(i){return i.key}),listBoxes.enter().append("div").attr("class","col-lg-3 col-md-4 col-sm-6 list-wrap").append("a").attr("href",function(i){return m.get(i.key).link}).attr("target","_blank").attr("class","list-link").append("div").attr("class","list-box").each(c),listBoxes.exit().remove(),listBoxes.sort(function(i,t){return m.get(i.key).sortBy[u]>m.get(t.key).sortBy[u]?1:-1})}function c(){var i=d3.select(this);i.append("div").style("background-image",function(i){return"url("+m.get(i.key).imageURL+")"}).attr("class","list-image").append("span").html(function(i){return m.get(i.key).imageURL?"":"Image"}),i.append("div").text(function(i){return m.get(i.key).title}).attr("class","list-title"),i.append("div").text(function(i){return m.get(i.key).subtitle}).attr("class","list-subtitle"),i.append("div").text(function(i){return m.get(i.key).text}).attr("class","list-text margin-top")}var a="listView"+Math.floor(1e4*Math.random()),r=[];$(document).ready(e),$(window).resize(e),r.push(i.onUpdate(a,function(){n.is(":visible")&&o()})),t.$watch(function(){return n.is(":visible")},o),t.$watch("listDimension",s),t.$watch("max",s),t.$watch("imageURLFunc",s),t.$watch("titleFunc",s),t.$watch("subtitleFunc",s),t.$watch("textFunc",s),t.$watch("linkFunc",s),t.$watch("sortOptions",s);var d,m,u,g;t.max?t.max:1/0;o()}};return t}]).directive("palladioListViewWithSettings",["palladioService","dataService",function(i,t){return{scope:{cardsHeight:"=",showSettings:"=",configTitleDimension:"=",configSubTitleDimension:"=",configTextDimension:"=",configLinkDimension:"=",configImgUrlDimension:"=",configSortDimension:"=",functions:"="},templateUrl:"partials/palladio-cards-component/template.html",link:{pre:function(n,e,s){function o(){e.css("min-height",$(window).height()-50)}function l(i){n.$apply(function(t){t.titleDim=n.metadata.filter(function(t){return t.key===i.titleDim})[0],t.subtitleDim=n.metadata.filter(function(t){return t.key===i.subtitleDim})[0],t.textDim=n.metadata.filter(function(t){return t.key===i.textDim})[0],t.linkDim=n.metadata.filter(function(t){return t.key===i.linkDim})[0],t.imgurlDim=n.metadata.filter(function(t){return t.key===i.imgurlDim})[0],t.sortDim=n.metadata.filter(function(t){return t.key===i.sortDim})[0],t.setInternalState(i)})}function c(){return n.readInternalState({titleDim:n.titleDim.key,subtitleDim:n.subtitleDim?n.subtitleDim.key:void 0,textDim:n.textDim?n.textDim.key:void 0,linkDim:n.linkDim?n.linkDim.key:void 0,imgurlDim:n.imgurlDim?n.imgurlDim.key:void 0,sortDim:n.sortDim?n.sortDim.key:void 0})}var a=[];n.uniqueToggleId="cardView"+Math.floor(1e4*Math.random()),n.uniqueModalId=n.uniqueToggleId+"modal",n.configTitleDimension&&(n.titleDim=n.configTitleDimension),n.configSubTitleDimension&&(n.subtitleDim=n.configSubTitleDimension),n.configTextDimension&&(n.textDim=n.configTextDimension),n.configLinkDimension&&(n.linkDim=n.configLinkDimension),n.configImgUrlDimension&&(n.imgurlDim=n.configImgUrlDimension),n.configSortDimension&&(n.sortDim=n.configSortDimension),n.metadata=t.getDataSync().metadata,n.xfilter=t.getDataSync().xfilter,n.fields=n.metadata.sort(function(i,t){return i.description<t.description?-1:1}),n.urlDims=n.metadata.filter(function(i){return"url"===i.type}).sort(function(i,t){return i.description<t.description?-1:1}),n.metadata.filter(function(i){return i.countBy===!0})[0]&&(n.listDim=n.metadata.filter(function(i){return i.countBy===!0})[0],n.titleDim||(n.titleDim=n.listDim)),n.id=n.xfilter.dimension(function(i){return""+i[n.listDim.key]}),n.id.accessor=function(i){return""+i[n.listDim.key]},n.$watch("titleDim",function(i,t){i!==t&&i?n.titleAccessor=function(t){return""+t[i.key]}:n.titleAccessor=function(i){return""+i[n.titleDim.key]}}),n.$watch("subtitleDim",function(i,t){i!==t&&i?n.subtitleAccessor=function(t){return""+t[i.key]}:n.subtitleDim?n.subtitleAccessor=function(i){return""+i[n.subtitleDim.key]}:n.subtitleAccessor=function(i){return"Select a subtitle dimension"}}),n.$watch("textDim",function(i,t){i!==t&&i?n.textAccessor=function(t){return""+t[i.key]}:n.textDim?n.textAccessor=function(i){return""+i[n.textDim.key]}:n.textAccessor=function(i){return"Select a text dimension"}}),n.$watch("linkDim",function(i,t){i!==t&&i?n.linkAccessor=function(t){return""+t[i.key]}:n.linkDim?n.linkAccessor=function(i){return""+i[n.linkDim.key]}:n.linkAccessor=function(i){return""}}),n.$watch("imgurlDim",function(i,t){i!==t&&i?n.imgurlAccessor=function(t){return""+t[i.key]}:n.imgurlDim?n.imgurlAccessor=function(i){return""+i[n.imgurlDim.key]}:n.imgurlAccessor=function(i){return""}}),n.$watch("sortDim",function(i,t){i!==t&&i?n.sortOptions=[{attribute:i.key}]:n.sortDim?n.sortOptions=[{attribute:n.sortDim.key}]:n.sortOptions=[{attribute:n.listDim.key}]}),n.$on("$destroy",function(){n.id&&n.id.remove(),a.forEach(function(i){i()})}),n.showTitleModal=function(){$("#"+n.uniqueModalId).find("#title-modal").modal("show")},n.showSubtitleModal=function(){$("#"+n.uniqueModalId).find("#subtitle-modal").modal("show")},n.showTextModal=function(){$("#"+n.uniqueModalId).find("#text-modal").modal("show")},n.showLinkModal=function(){$("#"+n.uniqueModalId).find("#link-modal").modal("show")},n.showImgURLModal=function(){$("#"+n.uniqueModalId).find("#imgurl-modal").modal("show")},n.showSortModal=function(){$("#"+n.uniqueModalId).find("#sort-modal").modal("show")},$(document).ready(o),$(window).resize(o),n.setInternalState=function(i){return i},n.readInternalState=function(i){return i},n.functions&&(n.functions.getSettings=function(){return e.find(".cards-settings")[0]},n.functions.importState=function(i){return l(i),!0},n.functions.exportState=function(){return c()}),a.push(i.registerStateFunctions("listView","listView",c,l))},post:function(i,t,n){$(document).ready(function(){t.find(".settings-toggle").click(function(){t.find(".settings").toggleClass("closed")})})}}}}]),angular.module("palladio").run(["$templateCache",function(i){i.put("partials/palladio-cards-component/template.html",'<div class="container-fluid">\n\n  <div data-palladio-list-view\n    list-dimension="id"\n    cards-height="cardsHeight"\n    max-to-display="1000"\n    img-url-accessor="imgurlAccessor"\n    title-accessor="titleAccessor"\n    subtitle-accessor="subtitleAccessor"\n    text-accessor="textAccessor"\n    link-accessor="linkAccessor"\n    sort-options="sortOptions"></div>\n\n</div>\n\n<!-- Settings -->\n<div class="row cards-settings" data-ng-show="showSettings || showSettings === undefined">\n\n    <div class="settings col-lg-4 col-lg-offset-8 col-md-6 col-md-offset-6">\n      <div class="panel panel-default">\n\n        <a class="settings-toggle" data-toggle="tooltip" data-original-title="Settings" data-placement="bottom">\n          <i class="fa fa-bars"></i>\n        </a>\n\n        <div class="panel-body">\n\n          <div class="row">\n            <div class="col-lg-12">\n              <label>Settings</label>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Title</label>\n            </div>\n            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showTitleModal()">\n                  {{titleDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Subtitle</label>\n            </div>\n            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showSubtitleModal()">\n                  {{subtitleDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Text</label>\n            </div>\n            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showTextModal()">\n                  {{textDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Link</label>\n            </div>\n            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showLinkModal()">\n                  {{linkDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Image URL</label>\n            </div>\n            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showImgURLModal()">\n                  {{imgurlDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Sort by</label>\n            </div>\n            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showSortModal()">\n                  {{sortDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n        </div>\n\n      </div>\n    </div>\n\n</div>\n\n<div id="{{uniqueModalId}}">\n  <div id="title-modal" data-modal description="Choose title (a unique value)" dimensions="fields" model="titleDim"></div>\n  <div id="subtitle-modal" data-modal description="Choose sub-title" dimensions="fields" model="subtitleDim"></div>\n  <div id="text-modal" data-modal description="Choose text" dimensions="fields" model="textDim"></div>\n  <div id="link-modal" data-modal description="Choose link (URL to launch on click)" dimensions="urlDims" model="linkDim"></div>\n  <div id="imgurl-modal" data-modal description="Choose image (URL of image)" dimensions="urlDims" model="imgurlDim"></div>\n  <div id="sort-modal" data-modal description="Choose sort order dimension" dimensions="fields" model="sortDim"></div>\n</div>')}]);