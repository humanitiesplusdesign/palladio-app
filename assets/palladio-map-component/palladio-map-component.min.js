var mapboxStylesMap={"cesta.hd9ak6ie":"cesta/ckg1piv57010w19putr06104b","cesta.k8gof2np":"mapbox/satellite-v9","cesta.k8m9p19p":"cesta/ckg1qp80v02631apq1amjacri","cesta.k8ghh462":"cesta/ckg2j7auf0tyz19s2fqt7o07n","cesta.k8g7eofo":"cesta/ckg2k36b80upx19pua1dy7y4z"};angular.module("palladioMapComponent",["palladio","palladio.services"]).run(["componentService",function(e){var t=function(e,t){e.showSettings=void 0===e.showSettings||e.showSettings,e.mapHeight=void 0===e.height?"100%":e.height,e.scrollWheelZoom=void 0===e.scrollWheelZoom||e.scrollWheelZoom,e.functions={};var n='<div class="with-settings" data-palladio-map-view-with-settings ';return n+="show-settings=showSettings ",n+="map-height=mapHeight ",n+="scroll-wheel-zoom=scrollWheelZoom ",n+="functions=functions ",n+="></div>"};e.register("map",t)}]).directive("palladioMapView",["palladioService",function(e){var t={scope:{layers:"=",tileSets:"=",mapHeight:"=",scrollWheelZoom:"=",center:"=",zoom:"=",popoverDims:"=",popoverTitleLinkDim:"="},link:function(t,n,i){function o(){t.layers.forEach(a)}function a(e){e.sourceGroups&&e.sourceGroups.remove(),e.sourceGroups=null,e.destGroups&&e.destGroups.remove(),e.destGroups=null,e.nestedGroups&&e.nestedGroups.remove(),e.nestedGroups=null}function l(e,t){var n={type:"FeatureCollection",features:[]};return n.features=e.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:t(e)},properties:e}}),n}function s(e,t){var n={type:"FeatureCollection",features:[]};return n.features=e.map(function(e){if(!(isNaN(+t(e)[0][0])||isNaN(+t(e)[0][1])||isNaN(+t(e)[1][0])||isNaN(+t(e)[1][1])))return{type:"Feature",geometry:{type:"LineString",coordinates:t(e)},properties:e}}).filter(function(e){return e}),n}function r(n){var i=n.sourceAccessor||n.sourceCoordinatesAccessor,o=n.destinationAccessor||n.destinationCoordinatesAccessor;if(!n.sourceGroups)if(n.countBy){var a=reductio().exception(function(e){return e[n.countBy]}),s=a.value("hl").filter(e.getHighlight()).exception(function(e){return e[n.countBy]});t.popoverDims&&t.popoverDims.length&&a.dataList(!0),a.value("desc").exception(i),"COUNT"===n.aggregationType?(a.exceptionCount(!0),s.exceptionCount(!0),a.aliasProp({agg:function(e){return e.exceptionCount},initialAgg:function(e){return isNaN(e.initialAgg)||e.exceptionCount>+e.initialAgg?e.exceptionCount:e.initialAgg}}),s.aliasProp({agg:function(e){return e.exceptionCount}})):(a.exceptionSum(function(e){return+e[n.aggregateKey]}),s.exceptionSum(function(e){return+e[n.aggregateKey]}),a.aliasProp({agg:function(e){return e.exceptionSum},initialAgg:function(e){return isNaN(e.initialAgg)||e.exceptionSum>+e.initialAgg?e.exceptionSum:e.initialAgg}}),s.aliasProp({agg:function(e){return e.exceptionSum}})),n.sourceGroups=a(n.source.group()).order(function(e){return e.agg})}else{var a=reductio().aliasProp({agg:function(e){return e.agg+1},initialAgg:function(e){return isNaN(e.initialAgg)||e.agg>+e.initialAgg?e.agg:e.initialAgg}});a.value("desc").exception(i),t.popoverDims&&t.popoverDims.length&&a.dataList(!0),n.sourceGroups=a(n.source.group()).order(function(e){return e.agg})}if("point-to-point"==n.type&&n.destination&&!n.destGroups)if(n.countBy){var a=reductio().exception(function(e){return e[n.countBy]}),s=a.value("hl").filter(e.getHighlight()).exception(function(e){return e[n.countBy]});t.popoverDims&&t.popoverDims.length&&a.dataList(!0),a.value("desc").exception(o),"COUNT"===n.aggregationType?(a.exceptionCount(!0),s.exceptionCount(!0),a.aliasProp({agg:function(e){return e.exceptionCount},initialAgg:function(e){return isNaN(e.initialAgg)||e.exceptionCount>+e.initialAgg?e.exceptionCount:e.initialAgg}}),s.aliasProp({agg:function(e){return e.exceptionCount}})):(a.exceptionSum(function(e){return+e[n.aggregateKey]}),s.exceptionSum(function(e){return+e[n.aggregateKey]}),a.aliasProp({agg:function(e){return e.exceptionSum},initialAgg:function(e){return isNaN(e.initialAgg)||e.exceptionSum>+e.initialAgg?e.exceptionSum:e.initialAgg}}),s.aliasProp({agg:function(e){return e.exceptionSum}})),n.destGroups=a(n.destination.group()).order(function(e){return e.agg})}else{var a=reductio().aliasProp({agg:function(e){return e.agg+1},initialAgg:function(e){return isNaN(e.initialAgg)||e.agg>+e.initialAgg?e.agg:e.initialAgg}});a.value("desc").exception(o),t.popoverDims&&t.popoverDims.length&&a.dataList(!0),n.destGroups=a(n.destination.group()).order(function(e){return e.agg})}var r=d3.map();if(n.sourceGroups.all().forEach(function(e){e.value.desc.valueList=e.value.desc.values.map(function(e){return e[0]}),r.set(e.key,{agg:e.value.agg,desc:{values:e.value.desc.values,exceptionCount:e.value.desc.exceptionCount,valueList:e.value.desc.valueList},hl:{agg:e.value.hl.agg,exceptionCount:e.value.hl.exceptionCount,values:e.value.hl.values},initialAgg:e.value.initialAgg,data:e.value.dataList})}),n.destGroups){n.destGroups.all().forEach(function(e){r.has(e.key)?(r.get(e.key).agg+=+e.value.agg,r.get(e.key).hl.agg+=+e.value.hl.agg,r.get(e.key).initialAgg+=e.value.initialAgg,r.get(e.key).desc.valueList=r.get(e.key).desc.valueList.concat(e.value.desc.values.map(function(e){return e[0]})),r.get(e.key).data=r.get(e.key).data?r.get(e.key).data.concat(e.value.dataList):void 0):(e.value.desc.valueList=e.value.desc.values.map(function(e){return e[0]}),r.set(e.key,{agg:e.value.agg,desc:{values:e.value.desc.values,exceptionCount:e.value.desc.exceptionCount,valueList:e.value.desc.valueList},hl:{agg:e.value.hl.agg,exceptionCount:e.value.hl.exceptionCount,values:e.value.hl.values},initialAgg:e.value.initialAgg,data:e.value.dataList}))})}return r.remove(void 0),l(r.entries(),function(e){return[+e.key.split(",")[0],+e.key.split(",")[1]]})}function c(e){return"point-to-point"==e.type?d(e):[]}function d(n){if(!n.destination)return[];if(!n.nestedGroups){var i=reductio().exception(function(e){return e[n.countBy]}),o=i.value("hl").filter(e.getHighlight()).exception(function(e){return e[n.countBy]});t.popoverDims&&t.popoverDims.length&&i.dataList(!0),i.value("sourceDesc").exception(n.sourceAccessor),i.value("destDesc").exception(n.destinationAccessor),"COUNT"===n.aggregationType?(i.exceptionCount(!0),o.exceptionCount(!0),i.aliasProp({agg:function(e){return e.exceptionCount},record:function(e,t){return t}}),o.aliasProp({agg:function(e){return e.exceptionCount}})):(i.exceptionSum(function(e){return+e[n.aggregateKey]}),o.exceptionSum(function(e){return+e[n.aggregateKey]}),i.aliasProp({agg:function(e){return e.exceptionSum},record:function(e,t){return t}}),o.aliasProp({agg:function(e){return e.exceptionSum}})),n.nestedGroups=i(n.filterDimension.group())}var a=[];n.nestedGroups.all().forEach(function(e){e.key[0]&&e.key[1]&&e.value.agg>0&&a.push({source:e.key[0],destination:e.key[1],value:e.value.agg,sourceDescriptions:e.value.sourceDesc.values.map(function(e){return e[0]}),destinationDescriptions:e.value.destDesc.values.map(function(e){return e[0]}),data:e.value.record})});var l=s(a,function(e){return[[+e.source.split(",")[0],+e.source.split(",")[1]],[+e.destination.split(",")[0],+e.destination.split(",")[1]]]});return l}function p(){D.values().forEach(function(e){$(e.node).popover("hide")}),D=d3.map()}function u(){function e(e){e.geoJson?a(e,this):o(e,this)}function i(){if(C||d3.select(n[0]).selectAll("div.legend").remove(),C){var e;if(e=d3.select(n[0]).select("div.legend"),e.empty()&&(e=d3.select(n[0]).selectAll("div.legend").data(function(e){return[e]}).enter().append("div").attr("class","legend")),t.layers.length>1){e.select("div.layer-legend").remove();var i=e.insert("div",":first-child").attr("class","layer-legend").style("position","relative");i.append("div").attr("class","legend-title").text("Layers"),i.selectAll("div.legend-swatch").data(t.layers).enter().append("div").html("&nbsp;").attr("class","legend-swatch").attr("data-toggle","tooltip").attr("data-placement","right").attr("data-container","body").attr("title",function(e){return e.description}).style("background-color",function(e){return e.color}).style("opacity",function(e){return e.enabled?1:.1}).on("click",function(e){$(this).tooltip("destroy"),e.toggle()}).call(function(e){e[0].forEach(function(e){$(e).tooltip({template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})})})}else d3.select(n[0]).select("div.layer-legend").remove();var o=t.layers.filter(function(e){return e.pointSize})[0],a=k?d3.scale.sqrt().domain([1,k]).range([3,26]):function(){return 3};if(o){e.select("div.point-legend").remove();var l=e.append("div").attr("class","point-legend").style("position","relative"),s=l.append("div").attr("class","legend-title").attr("data-toggle","tooltip").attr("data-placement","right").attr("data-container","body").attr("title",o.aggDescription).html(o.aggDescription);l.selectAll("div.circle").data([k,1]).enter().append("div").attr("class","circle").style("width",function(e,t){return 2*a(e)+"px"}).style("height",function(e,t){return 2*a(e)+"px"}).style("border-radius","50%").style("margin-top",function(e,t){return e<k?-(2*a(e))+"px":0}).style("margin-left",function(e,t){return e<k?a(k)-a(e)+"px":0}).append("span").attr("class","legend-title").style("margin-left",function(e){return-(a(k)-a(e))+2*a(k)+10+"px"}).html(String),$(s[0][0]).tooltip({template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})}}}function o(e,i){var o=d3.select(i),a=o.selectAll("g.layer").data(function(e){return[e]});a.enter().append("g").attr("class","layer"),a.exit().remove();var s=r(e),y=c(e),v=e.pointSize?d3.scale.sqrt().domain([1,k]).range([3,26]):function(){return 3},f=d3.geo.path().pointRadius(function(e){return v(e.properties.value.agg)}).projection(l),h=function(e){return(e.properties.value.hl.agg?e.properties.value.hl.agg:0)>0?.8:.2},x=y.feature?d3.scale.linear().domain([d3.min(y.features,function(e){return e.properties.value}),d3.max(y.features,function(e){return e.properties.value})]).range([2,20]):function(e){return 2};e.maxPointSize||(e.maxPointSize=k);var b=d3.select(n[0]).style("width"),w=d3.select(n[0]).style("height"),C=F.getBounds(),L=l(C._northEast),A=l(C._southWest);u.attr("width",b).attr("height",w).style("margin-left",A[0]+"px").style("margin-top",L[1]+"px"),a.attr("transform","translate("+-A[0]+","+-L[1]+")");var z=e.showLinks?y.features||[]:[];T=a.selectAll(".link").data(z.filter(function(e){return e.properties.value>0}),function(e){return e.properties.source+"-"+e.properties.destination}),T.exit().remove(),T.attr("stroke-width",function(e){return x(e.properties.value)}).attr("d",d).style("stroke",e.color).on("mouseover",E.show).on("mouseout",E.hide),T.enter().append("path").classed("link",!0).attr("stroke-width",function(e){return x(e.properties.value)}).attr("stroke-linecap","round").style("fill","none").style("stroke",e.color).style("opacity",".2").attr("d",d).on("mouseover",E.show).on("mouseout",E.hide);S=a.selectAll(".node").data(s.features.filter(function(e){return e.properties.value.agg>0&&!isNaN(e.geometry.coordinates[0])&&!isNaN(e.geometry.coordinates[1])}),function(e){return e.properties.key}),S.exit().remove(),S.attr("d",f).style("fill",e.color).style("stroke",e.color).style("opacity",h).on("mouseover",O.show).on("mouseout",O.hide),S.enter().append("path").classed("node",!0).attr("d",f).style("fill",e.color).style("stroke",e.color).style("opacity",h).on("mouseover",O.show).on("mouseout",O.hide).on("click",function(e){D.get(e.properties.key)&&D.get(e.properties.key).hasPopover===!0?p():t.popoverDims&&t.popoverDims.length&&(p(),D.set(e.properties.key,{node:this}),$(this).popover({title:function(){var e=d3.select(this).datum(),n=m(e.properties.value.desc.valueList)+" ("+e.properties.value.agg+")";if(t.popoverTitleLinkDim){var i=e.properties.value.data[0][t.popoverTitleLinkDim.key];i&&(n='<a target="_blank" href="'+e.properties.value.data[0][t.popoverTitleLinkDim.key]+'">'+n+"</a>")}return n},content:function(){var e=d3.select(this).datum(),n="";return t.popoverDims.forEach(function(t){var i=[];e.properties.value.data.map(function(e){return e[t.key]}).forEach(function(e){i.indexOf(e)===-1&&i.push(e)}),n+="<b>"+t.description+"</b>: "+i.join(", ")+"<br />"}),n},html:!0,trigger:"manual",container:$("body"),placement:"top",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),$(this).popover("show"),D.get(e.properties.key).hasPopover=!0)}),p();g(e)}function a(e,t){var i=d3.geo.path().projection(s),o=d3.select(t),a=o.selectAll("g.layer").data(function(e){return[e]});a.enter().append("g").attr("class","layer"),a.exit().remove();var r=d3.select(n[0]).style("width"),c=d3.select(n[0]).style("height"),d=F.getBounds(),p=l(d._northEast),g=l(d._southWest);u.attr("width",r).attr("height",c).style("margin-left",g[0]+"px").style("margin-top",p[1]+"px"),a.attr("transform","translate("+-g[0]+","+-p[1]+")");var m=a.selectAll("path").data(e.geoJson.features);m.exit().remove(),m.attr("d",i).attr("stroke",e.color).attr("fill",function(t){return e.fillShapes&&t.geometry&&("Point"===t.geometry.type||"Polygon"===t.geometry.type||"GeometryCollection"===t.geometry.type)?e.color:"none"}),m.enter().append("path").attr("d",i).attr("class","shape").attr("stroke",e.color).attr("fill",function(t){return e.fillShapes&&t.geometry&&("Point"===t.geometry.type||"Polygon"===t.geometry.type||"GeometryCollection"===t.geometry.type)?e.color:"none"}),m.attr("d",i)}function l(e){var t=F.latLngToLayerPoint(e);return[t.x,t.y]}function s(e){var t=F.latLngToLayerPoint([e[1],e[0]]);return[t.x,t.y]}function d(e){var t=l(e.geometry.coordinates[0]),n=l(e.geometry.coordinates[1]),i=Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2))/4,o=Math.atan2(n[1]-t[1],n[0]-t[0])-Math.PI/10,a=Math.atan2(t[1]-n[1],t[0]-n[0])+Math.PI/10;return w([[t[0],t[1]],[t[0]+i*Math.cos(o),t[1]+i*Math.sin(o)],[n[0]+i*Math.cos(a),n[1]+i*Math.sin(a)],[n[0],n[1]]])}var u=d3.select(F.getPanes().overlayPane).select("svg");u.empty()&&(u=d3.select(F.getPanes().overlayPane).append("svg"));var y=u.selectAll("g.leaflet-zoom-hide").data(t.layers.filter(function(e){return e.enabled}),function(e){return e.index});u.call(O),u.call(E),y.enter().append("g").attr("class","leaflet-zoom-hide"),y.exit().remove(),y.order(),F.on("viewreset",function(){y.each(e)}),F.on("moveend",function(){y.each(e)}),k=t.layers.reduce(function(e,t){var n=0;return t.geoJson||(n=d3.max(r(t).features.filter(function(e){return e.properties.key}),function(e){return e.properties.value.initialAgg})),e>n?e:n},0),C=t.layers.reduce(function(e,t){return e||t.pointSize},t.layers.length>1),y.each(e),i()}function g(e){if(S){var t=e.sourceAccessor||e.sourceCoordinatesAccessor,n=e.destinationAccessor||e.destinationCoordinatesAccessor;if(!b||!b.length)return S.classed("hidden-node",!1),void T.classed("hidden-link",!1);S.classed("hidden-node",function(e){var t=m(e.properties.value.desc.valueList).toLowerCase().indexOf(b.toLowerCase())!==-1;return!t}),T.classed("hidden-link",function(e){var i=t(e.properties.data).toLowerCase().indexOf(b.toLowerCase())!==-1||n(e.properties.data).toLowerCase().indexOf(b.toLowerCase())!==-1;return!i})}}function m(e){function t(e){for(var t={},n=[],i=e.length,o=0,a=0;a<i;a++){var l=e[a];1!==t[l]&&(t[l]=1,n[o++]=l)}return n}var n=t(e);return n.length>5?n.slice(0,5).join(", ")+" plus "+(n.length-5)+" more":n.join(", ")}function y(e,t){return m(e)+" → "+m(t)}function v(){t.layers.forEach(function(e,t){e.toggle||(e.toggle=function(){e.enabled=!e.enabled,u()})}),o(),u()}function f(){t.mapHeight&&"100%"!==t.mapHeight||n.height($(window).height()-50),F.invalidateSize(!1)}var h="mapView"+Math.floor(1e4*Math.random()),x=[],b="",w=d3.svg.line().interpolate("bundle");t.mapHeight?n.attr("style","height: "+t.mapHeight):n.attr("style","height: 100%;"),x.push(e.onUpdate(h,function(){n.is(":visible")&&(F.invalidateSize(!1),u())})),x.push(e.watchHighlight(h,function(){o()})),t.$watch(function(){return n.is(":visible")},u),x.push(e.onSearch(h,function(e){b=e,layers.forEach(g)}));var k,C,D=d3.map();L.mapbox.accessToken="pk.eyJ1IjoiY2VzdGEiLCJhIjoiMFo5dmlVZyJ9.Io52RcCMMnYukT77GjDJGA";var S,T,A=[45.464,9.1916],z=t.zoom&&"number"==typeof t.zoom?t.zoom:3,N=t.center&&Array.isArray(t.center)&&2===t.center.length?new L.LatLng(t.center[0],t.center[1]):new L.LatLng(A[0],A[1]),M=2,I=20,F=new L.Map(n[0],{center:N,zoom:z,minZoom:M,maxZoom:I,scrollWheelZoom:t.scrollWheelZoom,worldCopyJump:!0});F.attributionControl.addAttribution("© <a href='https://www.mapbox.com/map-feedback/'>Mapbox</a> © <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap contributors</a>"),L.control.scale().addTo(F);var P=L.Control.extend({options:{position:"topleft"},onAdd:function(e){var n=L.DomUtil.create("div","zoom-to-data-control leaflet-bar");L.DomEvent.addListener(n,"click",L.DomEvent.stopPropagation).addListener(n,"click",L.DomEvent.preventDefault).addListener(n,"click",function(){var e=[];t.layers.forEach(function(t){e=e.concat(t.sourceGroups.all().map(function(e){return e.key.split(",").map(parseFloat)})),t.destGroups&&(e=e.concat(t.destGroups.all().map(function(e){return e.key.split(",").map(parseFloat)})))}),e=e.filter(function(e){return!isNaN(e[0])&&!isNaN(e[1])}),e.length>0&&F.fitBounds(L.latLngBounds(e))});var i=L.DomUtil.create("a","leaflet-control-to-data",n);L.DomUtil.create("i","fa fa-object-group",i);return i.title="Zoom to data",i.href="#",n}});F.addControl(new P);var O=d3.tip().offset([-10,0]).attr("class","d3-tip").html(function(e){return m(e.properties.value.desc.valueList)+" ("+e.properties.value.agg+")"}),E=d3.tip().attr("class","d3-tip").html(function(e){return y(e.properties.sourceDescriptions,e.properties.destinationDescriptions)+" ("+e.properties.value+")"});t.title="Map View";""+t.title+Math.floor(1e4*Math.random());t.$watch("popoverDims",function(){o(),u()}),t.$watchCollection("layers",function(){v()}),t.$watch("layers",function(){v()}),t.$watch("center",function(){if(t.center&&Array.isArray(t.center)&&2===t.center.length){var e=new L.LatLng(t.center[0],t.center[1]);F.setView(e)}}),t.$watch("zoom",function(){t.zoom&&"number"==typeof t.zoom&&F.setZoom(t.zoom)}),t.$watchCollection("tileSets",function(e,n){n.forEach(function(t){e.indexOf(t)===-1&&F.removeLayer(t.layer)}),t.tileSets.forEach(function(e,n){e.layer||(e.url&&(e.layer=L.tileLayer(e.url)),e.wmsUrl&&(e.layer=L.tileLayer.wms(e.wmsUrl,{layers:e.wmsLayers,format:"image/png",transparent:!0})),e.mbId&&(e.layer=L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{accessToken:L.mapbox.accessToken,tileSize:512,maxZoom:18,zoomOffset:-1,id:Object.prototype.hasOwnProperty.call(mapboxStylesMap,e.mbId)?mapboxStylesMap[e.mbId]:e.mbId})),e.layer&&(e.layer.addTo(F),e.toggle=function(){e.enabled=!e.enabled,e.enabled?e.layer.setOpacity(1):e.layer.setOpacity(0)})),e.layer&&(e.layer.bringToBack(),e.remove=function(){F.removeLayer(e.layer),t.tileSets.splice(n,1)})})}),t.$on("resize",function(){F.invalidateSize(!1)}),$(document).ready(f),$(window).resize(f),t.$on("changeLayout",function(){F.invalidateSize(!1)})}};return t}]).directive("palladioMapViewWithSettings",["dataService","palladioService","exportService",function(e,t,n){var i={scope:{showSettings:"=",mapHeight:"=",scrollWheelZoom:"=",functions:"="},templateUrl:"partials/palladio-map-component/template.html",link:{pre:function(i,o,a){function l(e){e.mapping=i.mapping,e.type=i.mapType.value,e.descriptiveDim=i.descriptiveDim,e.pointSize=i.pointSize,e.showLinks=!!e.mapping.destinationCoordinates&&i.showLinks,e.color=i.color;var t=d3.map();e.mapping.sourceCoordinates&&void 0!==e.mapping.sourceCoordinates.typeField&&i.data.filter(function(t){return t[e.mapping.sourceCoordinates.typeField].indexOf(e.mapping.sourceCoordinates.description)!==-1}).forEach(function(n){t.set(n[e.mapping.sourceCoordinates.description],n)}),e.sourceCoordinatesAccessor=e.mapping.sourceCoordinates?function(n){return void 0===e.mapping.sourceCoordinates.typeField?""+n[e.mapping.sourceCoordinates.key]:t.has(n[e.mapping.sourceCoordinates.description])?""+t.get(n[e.mapping.sourceCoordinates.description])[e.mapping.sourceCoordinates.key]:""+n[e.mapping.sourceCoordinates.key]}:null,e.sourceAccessor=e.mapping.sourceCoordinates?function(n){return void 0===e.mapping.sourceCoordinates.typeField?e.descriptiveDim?""+n[e.descriptiveDim.key]:""+n[e.mapping.sourceCoordinates.key]:t.has(n[e.mapping.sourceCoordinates.description])?""+t.get(n[e.mapping.sourceCoordinates.description])[e.descriptiveDim.key]:""+n[e.mapping.sourceCoordinates.key]}:null,e.source&&e.source.remove(),e.source=e.mapping.sourceCoordinates?i.xfilter.dimension(e.sourceCoordinatesAccessor):null,e.source&&(e.source.accessor=e.sourceCoordinatesAccessor);var n=d3.map();e.mapping.destinationCoordinates&&void 0!==e.mapping.destinationCoordinates.typeField&&i.data.filter(function(t){return t[e.mapping.destinationCoordinates.typeField].indexOf(e.mapping.destinationCoordinates.description)!==-1}).forEach(function(t){n.set(t[e.mapping.destinationCoordinates.description],t)}),e.destinationCoordinatesAccessor=e.mapping.destinationCoordinates?function(t){return void 0===e.mapping.destinationCoordinates.typeField?""+t[e.mapping.destinationCoordinates.key]:n.has(t[e.mapping.destinationCoordinates.description])?""+n.get(t[e.mapping.destinationCoordinates.description])[e.mapping.destinationCoordinates.key]:""}:null,e.destinationAccessor=e.mapping.destinationCoordinates?function(t){return void 0===e.mapping.destinationCoordinates.typeField?e.descriptiveDim?""+t[e.descriptiveDim.key]:""+t[e.mapping.destinationCoordinates.key]:n.has(t[e.mapping.destinationCoordinates.description])?""+n.get(t[e.mapping.destinationCoordinates.description])[e.descriptiveDim.key]:""}:null,e.destination&&e.destination.remove(),e.destination=e.mapping.destinationCoordinates?i.xfilter.dimension(e.destinationCoordinatesAccessor):null,e.destination&&(e.destination.accessor=e.destinationCoordinatesAccessor),s(e),i.aggDim?"count"===i.aggDim.type?(e.countBy=i.aggDim.key,e.aggregationType="COUNT",e.aggregateKey=null,e.aggDescription=i.getAggDescription(i.aggDim)):(e.countBy=f.get(i.aggDim.fileId).key,e.aggregationType="SUM",e.aggregateKey=i.aggDim.key,e.aggDescription=i.getAggDescription(i.aggDim)):e.countBy=i.countDims.get(0).key}function s(e){e.filterDimension&&(e.filterDimension.filterAll(),e.filterDimension.remove()),e.source&&(e.destination?e.filterDimension=i.xfilter.dimension(function(t){return[e.source.accessor(t),e.destination.accessor(t)]}):e.filterDimension=i.xfilter.dimension(function(t){return[e.source.accessor(t)]}))}function r(e){i.$apply(function(t){e&&e.tileSets&&e.tileSets.length&&(t.tileSets=e.tileSets),e&&e.layers?e.layers.forEach(function(e){i.layerType=i.layerTypes.filter(function(t){return t.value===e.layerType})[0],i.description=e.description,i.descriptiveDim=i.metadata.filter(function(t){return t.key===e.descriptiveDimKey})[0]?i.metadata.filter(function(t){return t.key===e.descriptiveDimKey})[0]:i.descriptiveDim,i.mapping={sourceCoordinates:i.latlonFields.filter(function(t){return t.key===e.mapping.sourceCoordinatesKey&&t.description===e.mapping.sourceCoordinatesDescription})[0],destinationCoordinates:i.latlonFields.filter(function(t){return t.key===e.mapping.destinationCoordinatesKey&&t.description===e.mapping.destinationCoordinatesDescription})[0]},i.fillShapes=e.fillShapes,i.color=e.color,i.geoJson=JSON.stringify(e.geoJson),i.mapType=i.mapTypes.filter(function(t){return t.value===e.type})[0],i.pointSize=e.pointSize,i.showLinks=e.showLinks,i.aggDescription=e.aggDescription,i.aggregateKey=e.aggregateKey,i.aggregationType=e.aggregationType,i.aggDim=i.aggDims.filter(function(t){return i.getAggDescription(t)===e.aggDescription})[0],i.addLayer()}):e&&(t.countDim=e.countDim,t.descriptiveDim=e.descriptiveDim,t.showLinks=e.showLinks,t.pointSize=e.pointSize,t.mapType=t.mapTypes.filter(function(t){return t.value===e.mapType.value})[0],t.mapping={},e.mapping.sourceCoordinates&&(t.mapping.sourceCoordinates=t.latlonFields.filter(function(t){return t.description===e.mapping.sourceCoordinates.description})[0]),e.mapping.destinationCoordinates&&(t.mapping.destinationCoordinates=t.latlonFields.filter(function(t){return t.description===e.mapping.destinationCoordinates.description})[0]),e.aggDimKey&&(t.aggDim=t.aggDims.filter(function(t){return t.key===e.aggDimKey})[0]),t.addLayer()),e&&e.center&&(i.center=e.center),e&&e.zoom&&(i.zoom=e.zoom)})}function c(){return{center:i.center,zoom:i.zoom,tileSets:i.tileSets.map(function(e){return{url:e.url,wmsUrl:e.wmsUrl,wmsLayers:e.wmsLayers,mbId:e.mbId,enabled:e.enabled,description:e.description}}),layers:i.layers.map(function(e){return{aggDescription:e.aggDescription,fillShapes:e.fillShapes,geoJson:e.geoJson,aggregateKey:e.aggregateKey,aggregationType:e.aggregationType,color:e.color,countBy:e.countBy,description:e.description,enabled:e.enabled,layerType:e.layerType,descriptiveDimKey:e.descriptiveDim.key,mapping:{sourceCoordinatesKey:e.mapping&&e.mapping.sourceCoordinates&&e.mapping.sourceCoordinates.key?e.mapping.sourceCoordinates.key:null,sourceCoordinatesType:e.mapping&&e.mapping.sourceCoordinates&&e.mapping.sourceCoordinates.typeField?e.mapping.sourceCoordinates.typeField:null,sourceCoordinatesDescription:e.mapping&&e.mapping.sourceCoordinates&&e.mapping.sourceCoordinates.description?e.mapping.sourceCoordinates.description:null,destinationCoordinatesKey:e.mapping&&e.mapping.destinationCoordinates&&e.mapping.destinationCoordinates.key?e.mapping.destinationCoordinates.key:null,destinationCoordinatesType:e.mapping&&e.mapping.destinationCoordinates&&e.mapping.destinationCoordinates.typeField?e.mapping.destinationCoordinates.typeField:null,destinationCoordinatesDescription:e.mapping&&e.mapping.destinationCoordinates&&e.mapping.destinationCoordinates.description?e.mapping.destinationCoordinates.description:null},pointSize:e.pointSize,showLinks:e.showLinks,type:e.type}})}}function d(e){i.$apply(function(t){t.center=e})}function p(e){i.$apply(function(t){t.zoom=e})}function u(e){i.$apply(function(t){t.popoverDims=e})}function g(e){i.$apply(function(t){t.popoverTitleLinkDim=e})}function m(){var e={};return i.editingLayer&&(e=i.editingLayer,i.editingLayer=void 0),e.description=i.description,e.description||(i.mapping.sourceCoordinates&&i.mapping.destinationCoordinates?e.description=""+i.mapping.sourceCoordinates.description+" - "+i.mapping.destinationCoordinates.description:e.description=""+i.mapping.sourceCoordinates.description),void 0===e.index&&(e.index=h,h++),e.enabled=!0,e.layer=null,e.layerType=i.layerType.value,l(e),e.remove=function(){this.source&&this.source.remove(),this.destination&&this.destination.remove(),this.filterDimension&&this.filterDimension.remove(),i.layers.splice(i.layers.indexOf(this),1)},e.edit=function(){i.layerType=i.layerTypes[0],i.description=e.description,i.editingLayer=e,i.mapping=e.mapping,i.mapType=i.mapTypes.filter(function(t){return t.value===e.type})[0],i.descriptiveDim=e.descriptiveDim,i.pointSize=e.pointSize,i.showLinks=e.mapping.destinationCoordinates?e.showLinks:i.showLinks,i.color=e.color,i.addNewLayer=!0},e}function y(){var e={};return i.editingLayer&&(e=i.editingLayer,i.editingLayer=void 0),e.description=i.description,void 0===e.index&&(e.index=h,h++),e.enabled=!0,e.layer=null,e.layerType=i.layerType.value,e.fillShapes=i.fillShapes,e.color=i.color,e.geoJson=JSON.parse(i.geoJson),i.geoJson=null,e.remove=function(){i.layers.splice(i.layers.indexOf(this),1)},e.edit=function(){i.layerType=i.layerTypes[2],i.addNewLayer=!0,i.description=e.description,i.editingLayer=e,i.geoJson=JSON.stringify(e.geoJson),i.color=e.color,i.fillShapes=e.fillShapes},e}i.metadata=e.getDataSync().metadata,i.xfilter=e.getDataSync().xfilter,i.data=e.getDataSync().data,void 0===i.showSettings?i.settings=!0:i.settings=i.showSettings,i.tileSets=[{url:null,mbId:"cesta.hd9ak6ie",enabled:!0,description:"Land",layer:null}],i.uniqueToggleId="mapView"+Math.floor(1e4*Math.random()),i.uniqueModalId=i.uniqueToggleId+"modal";var v=[];i.mapTypes=[{description:"Points",value:"points",info:"A basic layer showing only the...",img:"img/data_point.jpg"},{description:"Point to point",value:"point-to-point",info:"A basic layer showing only the...",img:"img/data_points.jpg"}],i.mapType=i.mapTypes[0],i.getAggDescription=function(e){return"count"===e.type?"Number of "+e.field.countDescription:"Sum of "+e.field.description+" (from "+f.get(e.fileId).countDescription+" table)"};var f=d3.map();i.metadata.filter(function(e){return e.countable===!0}).forEach(function(e){f.set(e.originFileId?e.originFileId:0,e)}),i.aggDims=i.metadata.filter(function(e){return e.countable===!0||"number"===e.type}).map(function(e){return{key:e.key,type:e.countable?"count":"sum",field:e,fileId:e.originFileId?e.originFileId:0}}).filter(function(e){return!!f.get(e.fileId)}).sort(function(e,t){return i.getAggDescription(e)<i.getAggDescription(t)?-1:1}),i.aggDim=i.aggDims[0],i.showAggModal=function(){$("#"+i.uniqueModalId).find("#agg-modal").modal("show")},i.showLayerModal=function(){$("#"+i.uniqueModalId).find("#layer-modal").modal("show")},i.descriptiveDims=i.metadata.filter(function(e){return!i.metadata.filter(function(e){return"latlong"===e.type})[0]||e.originFileId===i.metadata.filter(function(e){return"latlong"===e.type})[0].originFileId}).sort(function(e,t){return e.countDescription<t.countDescription?-1:1}),i.metadata.filter(function(e){return"latlong"===e.type})[0]&&(i.descriptiveDim=i.metadata.filter(function(e){return"latlong"===e.type})[0].descriptiveField?i.metadata.filter(function(e){return"latlong"===e.type})[0].descriptiveField:i.metadata.filter(function(e){return"latlong"===e.type})[0]),i.showDescriptionModal=function(){$("#"+i.uniqueModalId).find("#description-modal").modal("show")},i.stringFields=i.metadata.filter(function(e){return"text"===e.type}),i.latlonFields=[],i.filterDimension=null,i.metadata.filter(function(e){return"latlong"===e.type}).forEach(function(e){void 0===e.typeField||0===e.typeField.length?i.latlonFields.push(e):e.typeFieldUniques.forEach(function(t){t.forEach(function(t){var n=angular.copy(e);n.description=i.metadata.filter(function(e){return e.key===t})[0].description,i.latlonFields.push(n)})})}),i.dateFields=i.metadata.filter(function(e){return"date"===e.type}),i.showLinks=!0,i.mapType=i.mapTypes[0],i.mapping={},i.metadata.filter(function(e){return e.countBy===!0})[0]&&(i.countBy=i.metadata.filter(function(e){return e.countBy===!0})[0].key,i.countDescription=i.metadata.filter(function(e){return e.countBy===!0})[0].description),i.$on("$destroy",function(){i.layers.forEach(function(e){e.source&&e.source.remove(),e.destination&&e.destination.remove()}),v.forEach(function(e){e()})}),i.functions&&(i.functions.importState=r,i.functions.exportState=c,i.functions.centerCoordinates=d,i.functions.zoomLevel=p,i.functions.popoverDims=u,i.functions.popoverTitleLinkDim=g,i.functions.getSettings=function(){return o.find(".map-settings")[0]}),i.layerTypes=[{description:"Data",value:"data",info:"Data layers allow you to display your data on the map as points and connections between them."},{description:"Map tiles",value:"tiles",info:null},{description:"geoJSON",value:"geoJSON",info:"Upload a geoJSON file including polygon features to overlay on the map."}],i.tilesTypes=[{mbId:"cesta/ckg1piv57010w19putr06104b",description:"Land",info:"A basic layer, showing only lands.",img:"img/map_land.jpg"},{mbId:"cesta/ckg2k36b80upx19pua1dy7y4z",description:"Buildings and Areas",info:"Buildings and green areas",img:"img/map_buildings.jpg"},{mbId:"cesta/ckg1qp80v02631apq1amjacri",description:"Streets",info:"A layer containing only topographical information (e.g. streets, cities, countries)",img:"img/map_street.jpg"},{mbId:"cesta/ckg2j7auf0tyz19s2fqt7o07n",description:"Terrain",info:"Shows natural features of the territories (e.g. mountains, lakes, rivers, green areas)",img:"img/map_terrain.jpg"
},{mbId:"mapbox/satellite-v9",description:"Satellite",info:"Satellite photos",img:"img/map_satellite.jpg"},{custom:!0,description:"Custom tiles",info:"Choose one of the following methods to add custom tiles"}],i.tilesType=i.tilesTypes[0],i.url=null,i.wmsUrl=null,i.wmsLayers=null,i.mbId=null,i.description=null,i.layers=[],i.addLayer=function(){"tiles"===i.layerType.value&&i.tilesType&&!i.tilesType.custom?i.tileSets.unshift({url:null,mbId:i.tilesType.mbId,enabled:!0,description:i.description?i.description:i.tilesType.description,layer:null}):"tiles"===i.layerType.value&&(i.url||i.mbId||i.wmsUrl&&i.wmsLayers)?i.tileSets.unshift({url:i.url?i.url:null,mbId:i.mbId?i.mbId:null,wmsUrl:i.wmsUrl?i.wmsUrl:null,wmsLayers:i.wmsLayers?i.wmsLayers:null,enabled:!0,description:i.description,layer:null}):"data"===i.layerType.value?i.editingLayer?(m(),i.layers=i.layers.slice()):i.layers.push(m()):"geoJSON"===i.layerType.value&&(i.editingLayer?(y(),i.layers=i.layers.slice()):i.layers.push(y())),i.url=null,i.wmsUrl=null,i.wmsLayers=null,i.mbId=null,i.description=null,i.mapping={}};var h=0;i.cmRefresh=!0,i.$watch("geoJson",function(){i.cmRefresh=!i.cmRefresh}),i.tilesType=i.tilesTypes[0],i.selectTile=function(e){i.tilesType=e},i.selectMap=function(e){i.mapType=e},i.getAndExportSvg=function(){n(d3.select(o[0]).select("svg"),"Palladio Map.svg")},v.push(t.registerStateFunctions(i.uniqueToggleId,"mapView",c,r))},post:function(e,t,n){$(document).ready(function(){t.find(".settings-toggle").click(function(){t.find(".settings").toggleClass("closed")})})}}};return i}]),angular.module("palladio").run(["$templateCache",function(e){e.put("partials/palladio-map-component/template.html",'<div class="view">\n\t<!-- View -->\n\n\t<div data-palladio-map-view\n\t\tmap-height="mapHeight"\n    scroll-wheel-zoom="scrollWheelZoom"\n\t\ttile-sets="tileSets"\n\t\tlayers="layers"\n\t\tzoom="zoom"\n\t\tcenter="center"\n\t\tpopover-dims="popoverDims"\n\t\tpopover-title-link-dim="popoverTitleLinkDim">\n\t</div>\n\t<div id="palladio-map-popover" style="position: absolute; height: 100px; width: 100px; top: 0px; left: 0px; opacity: 0; pointer-events: none; box-sizing: border-box;"></div>\n</div>\n\n<!-- Settings -->\n<div class="row map-settings" data-ng-show="settings">\n\n  <div class="settings col-lg-5 col-lg-offset-7 col-md-6 col-md-offset-6">\n    <div class="panel panel-default">\n\n      <a class="settings-toggle">\n        <i class="fa fa-bars"></i>\n      </a>\n\n\n      <!-- Body -->\n      <div class="panel-body">\n\n        <p>Map layers</p>\n\n        <div class="row margin-top" data-ng-show="!addNewLayer">\n          <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n            <label class="inline">Data/Shapes</label>\n          </div>\n          <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n            <ul class="layer-list list-unstyled sortable-override" ui-sortable="{axis:y, containment: \'parent\'}" data-ng-model="layers" data-ng-show="layers.length">\n              <li class="layer-item" data-ng-repeat="layer in layers | orderBy:index:true" ng-style="{\'border-right\':\'5px solid \' + layer.color}">\n\n                <i\n                tooltip="{{layer.enabled ? \'Hide\' : \'Show\'}}"\n                tooltip-animation="false"\n                tooltip-append-to-body="true"\n                class="fa text-muted" data-ng-class="layer.enabled ? \'fa-eye\' : \'fa-eye-slash\'" data-ng-click="layer.toggle()" data-title="{{layer.enabled ? \'Hide\' : \'Show\'}}" bs-tooltip></i>\n\n                <span style="margin-left: 10px">{{layer.description}}</span>\n                <i\n                  tooltip="Delete layer"\n                  tooltip-animation="false"\n                  tooltip-append-to-body="true"\n                  class="fa fa-trash-o pull-right text-danger" data-container="body" data-title="Delete" bs-tooltip data-ng-click="layer.remove();" style="line-height: 1.6"></i>\n\n                <i\n                tooltip="Edit"\n                tooltip-animation="false"\n                tooltip-append-to-body="true"\n                class="fa fa-pencil pull-right margin-right text-primary" data-container="body" data-title="Edit" bs-tooltip data-ng-click="layer.edit();" style="line-height: 1.6"></i>\n\n              </li>\n            </ul>\n\n            <ul data-ng-show="!layers.length" class="list-unstyled sortable-override">\n              <li class="layer-item">\n                <span class="text-muted">No data layers</span>\n              </li>\n            </ul>\n\n            <a\n            ng-show="layers.length"\n            tooltip="Export data layers (svg)"\n            tooltip-animation="false"\n            tooltip-append-to-body="true"\n            class="pull-right small margin-bottom" ng-click="getAndExportSvg()">\n              Export\n            </a>\n\n          </div>\n        </div>\n\n        <div class="row" data-ng-show="!addNewLayer">\n          <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n            <label class="inline">Tiles</label>\n          </div>\n          <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n            <ul class="layer-list list-unstyled sortable-override" ui-sortable="{axis:y, containment: \'parent\'}" data-ng-model="tileSets" data-ng-show="tileSets.length">\n              <li class="layer-item" data-ng-repeat="layer in tileSets | orderBy:index">\n\n                <i tooltip="{{layer.enabled ? \'Hide\' : \'Show\'}}"\n                tooltip-animation="false"\n                tooltip-append-to-body="true"\n                class="fa text-muted" data-ng-class="layer.enabled ? \'fa-eye\' : \'fa-eye-slash\'" data-ng-click="layer.toggle()" data-title="{{layer.enabled ? \'Hide\' : \'Show\'}}" bs-tooltip></i>\n\n                <span style="margin-left: 10px">{{layer.description}}</span>\n                <i\n                tooltip="Delete layer"\n                tooltip-animation="false"\n                tooltip-append-to-body="true"\n                class="fa fa-trash-o pull-right" data-title="Delete" bs-tooltip data-ng-click="layer.remove();" style="line-height: 1.6"></i>\n              </li>\n            </ul>\n            <ul data-ng-show="!tileSets.length" class="list-unstyled sortable-override">\n              <li class="layer-item">\n                <span class="text-muted">No tilesets</span>\n              </li>\n            </ul>\n            <p class="help-block">Sort layers by dragging them</p>\n            <a class="btn btn-default pull-right" data-ng-click="addNewLayer=true"><i class="fa fa-file-o text-primary margin-right"></i>New layer</a>\n\n          </div>\n        </div>\n\n\n        <div class="row margin-top">\n          <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n          </div>\n          <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n\n          </div>\n        </div>\n\n\n\n\n        <!-- Choosing layer -->\n\n        <div class="" data-ng-show="addNewLayer">\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Type</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <ul class="nav nav-tabs" role="tablist" data-ng-init="layerType=layerTypes[0]">\n                <li data-ng-class="{\'active\' : layerType.value ==\'data\'}"><a ng-click="layerType=layerTypes[0]" role="tab" data-toggle="tab">Data</a></li>\n                <li data-ng-class="{\'active\' : layerType.value ==\'tiles\'}"><a ng-click="layerType=layerTypes[1]" role="tab" data-toggle="tab">Tiles</a></li>\n                <li data-ng-class="{\'active\' : layerType.value ==\'geoJSON\'}"><a ng-click="layerType=layerTypes[2]" role="tab" data-toggle="tab">Shapes</a></li>\n              </ul>\n              <span class="help-block">{{layerType.info}}</span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Name</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <input class="form-control" type="text" ng-model="description" placeholder="Layer {{tileSets.length}}">\n            </div>\n          </div>\n\n\n\n\n        <!-- Tiles -->\n\n        <div class="" data-ng-show="layerType.value==\'tiles\'">\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Tiles type</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8">\n              <div class="row">\n                <div class="col-lg-6 col-md-6 margin-bottom" style="padding-left:0" data-ng-repeat="tile in tilesTypes" data-ng-click="selectTile(tile)">\n                  <div class="layer-img" style="background-image:url({{tile.img}})" data-ng-class="{active:tilesType==tile, \'short-layer-img\': tilesType.custom}">\n                    <span data-ng-class="{\'text-white\':tile.description==\'Satellite\'}">{{tile.description}}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="row">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <p class="help-block">{{tilesType.info}}</p>\n            </div>\n          </div>\n\n          <div class="row margin-top" ng-show="tilesType && tilesType.custom">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Tileset URL</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <input type="text" id="layerUrl" ng-model="url" class="form-control" placeholder="e.g. http://maps.nypl.org/warper/maps/tile/13529/{z}/{x}/{y}.png">\n              <span class="help-block">Google/OSM schema tiles, using {x}, {y}, {z}</span>\n            </div>\n          </div>\n\n          <div class="row" ng-show="tilesType && tilesType.custom">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">WMS URL</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <input type="text" id="layerWmsUrl" ng-model="wmsUrl" class="form-control" placeholder="e.g. http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi">\n            </div>\n          </div>\n\n          <div class="row margin-top" ng-show="tilesType && tilesType.custom">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">WMS Layers</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <input type="text" id="layerWmsLayers" ng-model="wmsLayers" class="form-control" placeholder="e.g. nexrad-n0r-900913">\n            </div>\n          </div>\n\n          <div class="row margin-top" ng-show="tilesType && tilesType.custom">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Mapbox ID</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n            <input type="text" id="layerMbId" ng-model="mbId" class="form-control" placeholder="e.g. examples.map-zr0njcqy">\n            <span class="help-block">A Mapbox map ID. <a href="https://www.mapbox.com/help/define-map-id/" target="_blank">Click here to learn more</a></span>\n            </div>\n          </div>\n\n\n\n        </div>\n\n\n        <!-- Data -->\n\n        <div class="" data-ng-show="layerType.value==\'data\'">\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Map type</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8">\n              <div class="row">\n                <div class="col-lg-6 col-md-6 margin-bottom" style="padding-left:0" data-ng-repeat="map in mapTypes" data-ng-click="selectMap(map)">\n                  <div class="layer-img" style="background-image:url({{map.img}})" data-ng-class="{active:mapType==map}">\n                    <span>{{map.description}}</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="row margin-top" ng-show="mapType.value==\'points\' || mapType.value==\'sequence\'">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Places</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n\n              <ui-select ng-model="mapping.sourceCoordinates" theme="selectize" ng-disabled="disabled">\n                <ui-select-match placeholder="Select or search">\n                  {{$select.selected.description}}\n                  <span class="caret"></span>\n                </ui-select-match>\n                <ui-select-choices repeat="field in latlonFields | filter: {description:$select.search}">\n                  <span ng-bind-html="field.description | highlight: $select.search"></span>\n                </ui-select-choices>\n              </ui-select>\n\n            </div>\n          </div>\n\n          <div class="row margin-top" ng-show="mapType.value==\'point-to-point\'">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Source Places</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n\n              <ui-select ng-model="mapping.sourceCoordinates" theme="selectize" ng-disabled="disabled">\n                <ui-select-match placeholder="Select or search">\n                  {{$select.selected.description}}\n                  <span class="caret"></span>\n                </ui-select-match>\n                <ui-select-choices repeat="field in latlonFields | filter: {description:$select.search}">\n                  <span ng-bind-html="field.description | highlight: $select.search"></span>\n                </ui-select-choices>\n              </ui-select>\n\n            </div>\n          </div>\n          <div class="row margin-top" ng-show="mapType.value==\'point-to-point\'">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Target Places</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n\n              <ui-select ng-model="mapping.destinationCoordinates" theme="selectize" ng-disabled="disabled">\n                <ui-select-match placeholder="Select or search">\n                  {{$select.selected.description}}\n                  <span class="caret"></span>\n                </ui-select-match>\n                <ui-select-choices repeat="field in latlonFields | filter: {description:$select.search}">\n                  <span ng-bind-html="field.description | highlight: $select.search"></span>\n                </ui-select-choices>\n              </ui-select>\n\n            </div>\n\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Tooltip label</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showDescriptionModal()">\n                  {{descriptiveDim.description || "Choose"}}\n                  <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n              <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n                <label class="inline">Color</label>\n              </div>\n              <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n\n                <div class="input-group" ng-init="color=\'#666\'">\n                  <span class="input-group-addon" colorpicker id="sizing-addon1" ng-model="color" ng-style="{\'background-color\':color}"></span>\n                  <input type="text" colorpicker class="form-control" aria-describedby="sizing-addon1" ng-model="color">\n                </div>\n            </div>\n          </div>\n\n          <div class="row margin-top" ng-show="mapType.value==\'point-to-point\' || mapType.value==\'sequence\'">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Show links</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n                <input type="checkbox" ng-model="showLinks">\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Size points</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n                <input type="checkbox" ng-model="pointSize">\n            </div>\n          </div>\n\n          <div class="row margin-top" data-ng-show="pointSize">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right ">\n              <label class="inline">According to</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <span class="btn btn-default" ng-click="showAggModal()">\n                {{getAggDescription(aggDim) || "Choose"}}\n                <span class="caret"></span>\n              </span>\n            </div>\n          </div>\n\n        </div>\n\n        <!-- GeoJSON -->\n\n        <div class="" data-ng-show="layerType.value==\'geoJSON\'">\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">geoJSON</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n              <textarea class="col-md-8 col-xs-8" id="layerGeoJSON" ng-model="geoJson" ui-codemirror="{ mode : \'javascript\', lineNumbers : true, lineWrapping: true }" placeholder="Paste your geoJSON data or drop a file here" ui-refresh="cmRefresh"></textarea>\n\n              <span class="help-block">Drop geoJSON file or paste geoJSON in the area above</span>\n\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Color</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n\n              <div class="input-group" ng-init="color=\'#666\'">\n                <span class="input-group-addon" colorpicker id="sizing-addon1" ng-model="color" ng-style="{\'background-color\':color}"></span>\n                <input type="text" colorpicker class="form-control" aria-describedby="sizing-addon1" ng-model="color">\n              </div>\n            </div>\n          </div>\n\n          <div class="row margin-top">\n            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n              <label class="inline">Fill shapes</label>\n            </div>\n            <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n                <input type="checkbox" ng-model="fillShapes">\n            </div>\n          </div>\n        </div>\n\n        <div class="row margin-top">\n          <div class="col-lg-3 col-md-3 col-sm-4 col-xs-4 text-right">\n          </div>\n          <div class="col-lg-9 col-md-9 col-md-8 col-xs-8 col-condensed">\n            <div class="pull-right">\n              <a class="btn btn-default" data-ng-disabled="layerType.value === \'data\' && ((!mapping.sourceCoordinates || (mapType.value==\'point-to-point\' && !mapping.destinationCoordinates)))" data-ng-click="addLayer();addNewLayer=false;">\n                {{ editingLayer ? \'Apply\' : \'Add layer\' }}\n              </a>\n              <a class="btn btn-default btn-cancel" data-ng-click="addNewLayer=false">Cancel</a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div id="{{uniqueModalId}}">\n\t<div id="agg-modal" data-modal dimensions="aggDims" model="aggDim"\n\t\t\tdescription-accessor="getAggDescription"></div>\n\t<div id="description-modal" data-modal dimensions="descriptiveDims" model="descriptiveDim"></div>\n\t<div id="layer-modal" data-layer-modal layers="tileSets"></div>\n</div>\n')}]);